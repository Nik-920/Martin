<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Análisis DBSCAN</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="particles"></div>

    <div class="main-layout">
        <!-- ASIDE: Navegación lateral -->
        <aside class="sidebar">
            <div class="nav-section">
                <h2 class="nav-title">Provincias</h2>
                <nav class="nav-list">
                    {% for provincia in provincias %}
                    <form method="POST" action="/">
                        <input type="hidden" name="provincia" value="{{ provincia }}">
                        <button type="submit" class="nav-button">
                            <i class="fas fa-map-marker-alt"></i>
                            {{ provincia.replace('_', ' ').title() }}
                        </button>
                    </form>
                    {% endfor %}
                </nav>
            </div>

            <!-- Botón Power BI -->
            <div class="nav-section powerbi-section">
                <h2 class="nav-title">Dashboard</h2>
                <form method="POST" action="/">
                    <input type="hidden" name="powerbi" value="true">
                    <button type="submit" class="powerbi-button">
                        <i class="fas fa-chart-pie"></i>
                        Power BI Dashboard
                    </button>
                </form>
            </div>
        </aside>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="content-wrapper">
            <div class="container">
                <!-- HEADER -->
                <header>
                    <h1 class="header-title">Sistema de Análisis DBSCAN</h1>
                    <p class="header-subtitle">Clustering de Infracciones de Tránsito - San Martín</p>
                </header>

                <!-- MAIN CONTENT -->
                <main>
                    {% if powerbi %}
                    <!-- Sección de Power BI Dashboard -->
                    <section class="analysis-section">
                        <div class="province-header">
                            <h2 class="section-title">
                                <i class="fas fa-chart-pie"></i>
                                Power BI Dashboard
                            </h2>
                            <div class="province-badge powerbi-badge">
                                <i class="fas fa-chart-bar"></i>
                                Análisis Interactivo
                            </div>
                        </div>

                        <!-- Contenedor del Dashboard -->
                        <div class="powerbi-container">
                            <iframe
                                title="Power BI Dashboard"
                                src="https://app.powerbi.com/view?r=eyJrIjoiOWM3NTEyZjgtYmM2NC00ZjA0LWJhOGEtMmFhNzk4YTM1YTFhIiwidCI6IjNkYzUzMjI0LTdlNjEtNDk2Ny04ZmE0LTQ5ZmNkY2IxNTliYiIsImMiOjR9&embedImagePlaceholder=true"
                                frameborder="0"
                                allowFullScreen="true">
                            </iframe>
                        </div>
                    </section>
                    {% elif selected %}
                    <!-- Sección de Análisis -->
                    <section class="analysis-section">
                        <div class="province-header">
                            <h2 class="section-title">
                                <i class="fas fa-chart-line"></i>
                                Análisis de Clusters
                            </h2>
                            <div class="province-badge">
                                <i class="fas fa-location-dot"></i>
                                {{ selected.replace('_',' ').title() }}
                            </div>
                        </div>

                        <!-- Estadísticas -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <span class="stat-number">{{ provincias|length }}</span>
                                <span class="stat-label">Provincias Disponibles</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number">DBSCAN</span>
                                <span class="stat-label">Algoritmo de Clustering</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number">24h</span>
                                <span class="stat-label">Análisis Horario</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number">Real-time</span>
                                <span class="stat-label">Generación de Datos</span>
                            </div>
                        </div>

                        <!-- Contenedor de análisis -->
                        <div class="analysis-container">
                            <div class="analysis-card">
                                <div class="card-header">
                                    <i class="fas fa-chart-scatter card-icon"></i>
                                    <h3 class="card-title">Gráfico de Clusters</h3>
                                </div>
                                <div class="chart-container">
                                    {% if image %}
                                    <img src="data:image/png;base64,{{ image }}"
                                         alt="Clusters {{ selected }}">
                                    {% else %}
                                    <p>No se pudo generar el gráfico</p>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="card-header">
                                    <i class="fas fa-table card-icon"></i>
                                    <h3 class="card-title">Datos de Infracciones</h3>
                                </div>
                                <div class="table-container">
                                    {% if tabla %}
                                        {{ tabla | safe }}
                                    {% else %}
                                        <p>No hay datos disponibles</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </section>
                    {% else %}
                    <!-- Sección de bienvenida -->
                    <section class="welcome-section">
                        <div class="welcome-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <h2 class="welcome-title">Sistema de Análisis Avanzado</h2>
                        <p class="welcome-text">
                            Bienvenido al sistema de análisis de infracciones de tránsito utilizando algoritmos
                            de clustering DBSCAN. Seleccione una provincia del menú lateral para visualizar
                            los patrones de densidad horaria y análisis estadístico detallado.
                        </p>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <span class="stat-number">{{ provincias|length }}</span>
                                <span class="stat-label">Provincias Disponibles</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number">DBSCAN</span>
                                <span class="stat-label">Algoritmo de Clustering</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number">24h</span>
                                <span class="stat-label">Análisis Horario</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number">Real-time</span>
                                <span class="stat-label">Generación de Datos</span>
                            </div>
                        </div>
                    </section>
                    {% endif %}
                </main>

                <!-- FOOTER -->
                <footer>
                    <p class="footer-title">Sistema de Análisis de Infracciones - Región San Martín</p>
                    <p>Desarrollado con Flask + DBSCAN | © 2025</p>
                </footer>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Procesando análisis de clustering...</p>
    </div>

    <script>
        // Mostrar loading al enviar formulario
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', () => {
                document.getElementById('loading').classList.add('active');
            });
        });
    </script>
</body>
</html>
